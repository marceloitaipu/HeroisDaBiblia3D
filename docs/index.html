<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="description" content="Jogo educativo 3D com 5 mundos baseados em historias biblicas">
    <title>Herois da Biblia 3D</title>
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="manifest" href="manifest.json">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="TemplateData/style.css">
  </head>
  <body>
    <!-- Loading Screen -->
    <div id="loading-screen">
      <div id="loading-content">
        <div id="loading-icon">&#9775;</div>
        <h1 id="loading-title">Herois da Biblia 3D</h1>
        <p id="loading-subtitle">Preparando a aventura...</p>
        <div id="progress-container">
          <div id="progress-bar"></div>
        </div>
        <p id="progress-text">0%</p>
      </div>
      <div id="loading-particles"></div>
    </div>

    <!-- Game Container -->
    <div id="unity-container">
      <canvas id="unity-canvas" tabindex="-1"></canvas>
      <div id="unity-warning"></div>
      <!-- Floating Controls -->
      <div id="game-controls">
        <button id="fullscreen-btn" title="Tela cheia">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M8 3H5a2 2 0 00-2 2v3m18 0V5a2 2 0 00-2-2h-3m0 18h3a2 2 0 002-2v-3M3 16v3a2 2 0 002 2h3"/>
          </svg>
        </button>
      </div>
    </div>

    <script>
      const canvas = document.querySelector("#unity-canvas");
      const loadingScreen = document.querySelector("#loading-screen");
      const progressBar = document.querySelector("#progress-bar");
      const progressText = document.querySelector("#progress-text");
      const loadingSubtitle = document.querySelector("#loading-subtitle");

      function unityShowBanner(msg, type) {
        const warningBanner = document.querySelector("#unity-warning");
        const div = document.createElement('div');
        div.innerHTML = msg;
        div.className = 'banner-msg ' + (type || 'info');
        warningBanner.appendChild(div);
        warningBanner.style.display = 'block';
        if (type !== 'error') {
          setTimeout(() => {
            div.remove();
            if (!warningBanner.children.length) warningBanner.style.display = 'none';
          }, 5000);
        }
      }

      const buildUrl = "Build";
      const config = {
        arguments: [],
        dataUrl: buildUrl + "/docs.data.gz",
        frameworkUrl: buildUrl + "/docs.framework.js.gz",
        codeUrl: buildUrl + "/docs.wasm.gz",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "DefaultCompany",
        productName: "HeroisDaBiblia3D",
        productVersion: "1.0",
        showBanner: unityShowBanner,
      };

      // Responsive canvas sizing
      function resizeCanvas() {
        const w = window.innerWidth;
        const h = window.innerHeight;
        canvas.style.width = w + "px";
        canvas.style.height = h + "px";
      }
      resizeCanvas();
      window.addEventListener('resize', resizeCanvas);

      // Loading messages
      const loadingMessages = [
        "Preparando a aventura...",
        "Carregando mundos biblicos...",
        "Invocando os herois...",
        "Construindo a arca...",
        "Atravessando o Mar Vermelho...",
        "Quase la..."
      ];

      document.querySelector("#loading-screen").style.display = "flex";

      const script = document.createElement("script");
      script.src = buildUrl + "/docs.loader.js";
      script.onload = () => {
        createUnityInstance(canvas, config, (progress) => {
          const pct = Math.round(100 * progress);
          progressBar.style.width = pct + "%";
          progressText.textContent = pct + "%";
          const msgIndex = Math.min(Math.floor(progress * loadingMessages.length), loadingMessages.length - 1);
          loadingSubtitle.textContent = loadingMessages[msgIndex];
        }).then((unityInstance) => {
          // Fade out loading screen
          loadingScreen.style.opacity = "0";
          setTimeout(() => { loadingScreen.style.display = "none"; }, 600);

          document.querySelector("#fullscreen-btn").onclick = () => {
            unityInstance.SetFullscreen(1);
          };
        }).catch((message) => {
          loadingSubtitle.textContent = "Erro ao carregar o jogo";
          progressBar.style.background = "#e74c3c";
          console.error(message);
        });
      };
      document.body.appendChild(script);

      // Register service worker
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('service-worker.js');
      }
    </script>
  </body>
</html>
